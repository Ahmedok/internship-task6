services:
    # Development environment with hot-reload
    lib:
        image: node:24-alpine
        working_dir: /app
        volumes:
            - ./packages/lib:/app/packages/lib
            - ./package.json:/app/package.json
            - ./node_modules:/app/node_modules
        command: npm run dev --workspace=packages/lib

    server:
        image: node:24-alpine
        working_dir: /app
        volumes:
            - .:/app
            - /app/node_modules
            - /app/packages/client/node_modules
            - /app/packages/server/node_modules
            - /app/packages/lib/node_modules
        command: npm run dev:server
        ports:
            - "3000:3000"
        environment:
            - NODE_ENV=development
        depends_on:
            - lib

    client:
        image: node:24-alpine
        working_dir: /app
        volumes:
            - .:/app
            - /app/node_modules
            - /app/packages/client/node_modules
            - /app/packages/server/node_modules
            - /app/packages/lib/node_modules
        command: npm run dev
        ports:
            - "5173:5173"
        environment:
            - NODE_ENV=development
        depends_on:
            - lib
            - server
